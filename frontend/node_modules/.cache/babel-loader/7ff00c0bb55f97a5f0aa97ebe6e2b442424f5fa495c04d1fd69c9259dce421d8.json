{"ast":null,"code":"var _jsxFileName = \"/home/study/trading/frontend/src/Backtest.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useRef, useEffect } from 'react';\nimport axios from 'axios';\nimport { createChart } from 'lightweight-charts';\nimport ChartAndControls from './ChartAndControls';\nimport StartForm from './StartForm';\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst Backtest = () => {\n  _s();\n  const chartContainerRef = useRef(null);\n  const [candlestickSeries, setCandlestickSeries] = useState(null);\n  const [currentIndex, setCurrentIndex] = useState(0);\n  const [startDate, setStartDate] = useState('');\n  const [hasStarted, setHasStarted] = useState(false);\n  const [timeInterval, setTimeInterval] = useState('1');\n  const [clickedPoint, setClickedPoint] = useState(null);\n  const [totalPnL, setTotalPnL] = useState(0);\n  const [trades, setTrades] = useState([]);\n  const handleTrade = async action => {\n    try {\n      const response = await axios.post('http://127.0.0.1:5000/api/account', {\n        action,\n        price: candlestickSeries.currentData().close,\n        quantity: 1,\n        time: new Date().toISOString().split('T')[0]\n      });\n      setTrades(response.data.trades);\n      setTotalPnL(response.data.totalPnL);\n    } catch (error) {\n      console.error('Error placing trade:', error);\n    }\n  };\n  const addNewCandle = async () => {\n    if (!candlestickSeries || !hasStarted) return;\n    try {\n      const response = await axios.post('http://127.0.0.1:5000/api/backtest', {\n        currentIndex,\n        timeInterval\n      });\n      if (response.data.nextCandlestick) {\n        const newCandle = {\n          time: new Date(response.data.nextCandlestick.time).getTime() / 1000,\n          open: response.data.nextCandlestick.open,\n          high: response.data.nextCandlestick.high,\n          low: response.data.nextCandlestick.low,\n          close: response.data.nextCandlestick.close\n        };\n        candlestickSeries.update(newCandle);\n        setCurrentIndex(response.data.nextIndex);\n        setTrades(response.data.trades);\n        setTotalPnL(response.data.totalPnL);\n      }\n    } catch (error) {\n      console.error('Error fetching new candlestick:', error);\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      padding: '20px',\n      textAlign: 'center'\n    },\n    children: !hasStarted ? /*#__PURE__*/_jsxDEV(StartForm, {\n      setStartDate: setStartDate,\n      setTimeInterval: setTimeInterval,\n      setHasStarted: setHasStarted\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 59,\n      columnNumber: 9\n    }, this) : /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [/*#__PURE__*/_jsxDEV(ChartAndControls, {\n        chartContainerRef: chartContainerRef,\n        candlestickSeries: candlestickSeries,\n        setCandlestickSeries: setCandlestickSeries,\n        currentIndex: currentIndex,\n        setCurrentIndex: setCurrentIndex,\n        startDate: startDate,\n        timeInterval: timeInterval,\n        setClickedPoint: setClickedPoint,\n        setTotalPnL: setTotalPnL,\n        setTrades: setTrades,\n        handleTrade: handleTrade,\n        addNewCandle: addNewCandle\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 62,\n        columnNumber: 11\n      }, this), clickedPoint && /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          marginTop: '10px',\n          padding: '10px',\n          border: '1px solid #ccc',\n          backgroundColor: '#f9f9f9'\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n          children: \"Last Clicked Point:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 79,\n          columnNumber: 15\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n            children: \"Time:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 80,\n            columnNumber: 18\n          }, this), \" \", clickedPoint.time]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 80,\n          columnNumber: 15\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n            children: \"Price:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 81,\n            columnNumber: 18\n          }, this), \" \", clickedPoint.price.toFixed(5)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 81,\n          columnNumber: 15\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 78,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          marginTop: '20px',\n          padding: '10px',\n          border: '1px solid black'\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n          children: \"Trading Summary\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 86,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          children: [\"Total P/L:\", ' ', /*#__PURE__*/_jsxDEV(\"span\", {\n            style: {\n              fontWeight: 'bold',\n              color: totalPnL >= 0 ? 'green' : 'red'\n            },\n            children: [\"$\", totalPnL.toFixed(5)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 89,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 87,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 85,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 57,\n    columnNumber: 5\n  }, this);\n};\n_s(Backtest, \"I9ckiyNGBa3OynQG5rqWtwfnTFY=\");\n_c = Backtest;\nexport default Backtest;\nvar _c;\n$RefreshReg$(_c, \"Backtest\");","map":{"version":3,"names":["React","useState","useRef","useEffect","axios","createChart","ChartAndControls","StartForm","jsxDEV","_jsxDEV","Fragment","_Fragment","Backtest","_s","chartContainerRef","candlestickSeries","setCandlestickSeries","currentIndex","setCurrentIndex","startDate","setStartDate","hasStarted","setHasStarted","timeInterval","setTimeInterval","clickedPoint","setClickedPoint","totalPnL","setTotalPnL","trades","setTrades","handleTrade","action","response","post","price","currentData","close","quantity","time","Date","toISOString","split","data","error","console","addNewCandle","nextCandlestick","newCandle","getTime","open","high","low","update","nextIndex","style","padding","textAlign","children","fileName","_jsxFileName","lineNumber","columnNumber","marginTop","border","backgroundColor","toFixed","fontWeight","color","_c","$RefreshReg$"],"sources":["/home/study/trading/frontend/src/Backtest.js"],"sourcesContent":["import React, { useState, useRef, useEffect } from 'react';\nimport axios from 'axios';\nimport { createChart } from 'lightweight-charts';\nimport ChartAndControls from './ChartAndControls';\nimport StartForm from './StartForm';\n\nconst Backtest = () => {\n  const chartContainerRef = useRef(null);\n  const [candlestickSeries, setCandlestickSeries] = useState(null);\n  const [currentIndex, setCurrentIndex] = useState(0);\n  const [startDate, setStartDate] = useState('');\n  const [hasStarted, setHasStarted] = useState(false);\n  const [timeInterval, setTimeInterval] = useState('1');\n  const [clickedPoint, setClickedPoint] = useState(null);\n  const [totalPnL, setTotalPnL] = useState(0);\n  const [trades, setTrades] = useState([]);\n\n  const handleTrade = async (action) => {\n    try {\n      const response = await axios.post('http://127.0.0.1:5000/api/account', {\n        action,\n        price: candlestickSeries.currentData().close,\n        quantity: 1,\n        time: new Date().toISOString().split('T')[0]\n      });\n      setTrades(response.data.trades);\n      setTotalPnL(response.data.totalPnL);\n    } catch (error) {\n      console.error('Error placing trade:', error);\n    }\n  };\n\n  const addNewCandle = async () => {\n    if (!candlestickSeries || !hasStarted) return;\n\n    try {\n      const response = await axios.post('http://127.0.0.1:5000/api/backtest', { currentIndex, timeInterval });\n      if (response.data.nextCandlestick) {\n        const newCandle = {\n          time: new Date(response.data.nextCandlestick.time).getTime() / 1000,\n          open: response.data.nextCandlestick.open,\n          high: response.data.nextCandlestick.high,\n          low: response.data.nextCandlestick.low,\n          close: response.data.nextCandlestick.close,\n        };\n        candlestickSeries.update(newCandle);\n        setCurrentIndex(response.data.nextIndex);\n        setTrades(response.data.trades);\n        setTotalPnL(response.data.totalPnL);\n      }\n    } catch (error) {\n      console.error('Error fetching new candlestick:', error);\n    }\n  };\n\n  return (\n    <div style={{ padding: '20px', textAlign: 'center' }}>\n      {!hasStarted ? (\n        <StartForm setStartDate={setStartDate} setTimeInterval={setTimeInterval} setHasStarted={setHasStarted} />\n      ) : (\n        <>\n          <ChartAndControls\n            chartContainerRef={chartContainerRef}\n            candlestickSeries={candlestickSeries}\n            setCandlestickSeries={setCandlestickSeries}\n            currentIndex={currentIndex}\n            setCurrentIndex={setCurrentIndex}\n            startDate={startDate}\n            timeInterval={timeInterval}\n            setClickedPoint={setClickedPoint}\n            setTotalPnL={setTotalPnL}\n            setTrades={setTrades}\n            handleTrade={handleTrade}\n            addNewCandle={addNewCandle}\n          />\n\n          {clickedPoint && (\n            <div style={{ marginTop: '10px', padding: '10px', border: '1px solid #ccc', backgroundColor: '#f9f9f9' }}>\n              <h4>Last Clicked Point:</h4>\n              <p><strong>Time:</strong> {clickedPoint.time}</p>\n              <p><strong>Price:</strong> {clickedPoint.price.toFixed(5)}</p>\n            </div>\n          )}\n\n          <div style={{ marginTop: '20px', padding: '10px', border: '1px solid black' }}>\n            <h3>Trading Summary</h3>\n            <p>\n              Total P/L:{' '}\n              <span style={{ fontWeight: 'bold', color: totalPnL >= 0 ? 'green' : 'red' }}>\n                ${totalPnL.toFixed(5)}\n              </span>\n            </p>\n          </div>\n        </>\n      )}\n    </div>\n  );\n};\n\nexport default Backtest;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}